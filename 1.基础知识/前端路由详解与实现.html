<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>无来</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="喵巨人学习笔记，包含前端开发、后端开发、服务器运维等">
    
    <link rel="preload" href="/assets/css/0.styles.9825735b.css" as="style"><link rel="preload" href="/assets/js/app.24709d44.js" as="script"><link rel="preload" href="/assets/js/2.dc5a3d57.js" as="script"><link rel="preload" href="/assets/js/13.bd5b6688.js" as="script"><link rel="prefetch" href="/assets/js/10.c794d400.js"><link rel="prefetch" href="/assets/js/11.83384a2c.js"><link rel="prefetch" href="/assets/js/12.0fbf78c4.js"><link rel="prefetch" href="/assets/js/14.34024a37.js"><link rel="prefetch" href="/assets/js/15.9fc12c58.js"><link rel="prefetch" href="/assets/js/16.160b8a59.js"><link rel="prefetch" href="/assets/js/17.bccd17cd.js"><link rel="prefetch" href="/assets/js/18.20e2dd71.js"><link rel="prefetch" href="/assets/js/19.3442bdce.js"><link rel="prefetch" href="/assets/js/20.0e0a68c6.js"><link rel="prefetch" href="/assets/js/21.abb00f8b.js"><link rel="prefetch" href="/assets/js/22.6cc7f131.js"><link rel="prefetch" href="/assets/js/23.5e14693f.js"><link rel="prefetch" href="/assets/js/24.36002606.js"><link rel="prefetch" href="/assets/js/25.25893b98.js"><link rel="prefetch" href="/assets/js/26.fde36a0a.js"><link rel="prefetch" href="/assets/js/27.4ba350b6.js"><link rel="prefetch" href="/assets/js/28.f2f5fc74.js"><link rel="prefetch" href="/assets/js/29.7dc79e7e.js"><link rel="prefetch" href="/assets/js/3.48ed98e6.js"><link rel="prefetch" href="/assets/js/30.c199df18.js"><link rel="prefetch" href="/assets/js/31.93efdbfa.js"><link rel="prefetch" href="/assets/js/32.b5045023.js"><link rel="prefetch" href="/assets/js/33.0baa78a4.js"><link rel="prefetch" href="/assets/js/34.379a28bc.js"><link rel="prefetch" href="/assets/js/35.5db213af.js"><link rel="prefetch" href="/assets/js/36.abbf791a.js"><link rel="prefetch" href="/assets/js/37.2a2b729e.js"><link rel="prefetch" href="/assets/js/38.96ca3a8d.js"><link rel="prefetch" href="/assets/js/39.4cbce14b.js"><link rel="prefetch" href="/assets/js/4.43879640.js"><link rel="prefetch" href="/assets/js/40.33183112.js"><link rel="prefetch" href="/assets/js/41.c868a50a.js"><link rel="prefetch" href="/assets/js/42.b19cc7ed.js"><link rel="prefetch" href="/assets/js/43.0db4e585.js"><link rel="prefetch" href="/assets/js/44.c27ed0a9.js"><link rel="prefetch" href="/assets/js/45.bc9ca256.js"><link rel="prefetch" href="/assets/js/46.d12c99b4.js"><link rel="prefetch" href="/assets/js/47.b9b71d36.js"><link rel="prefetch" href="/assets/js/48.2a7078f4.js"><link rel="prefetch" href="/assets/js/49.c435b2e6.js"><link rel="prefetch" href="/assets/js/5.60572b82.js"><link rel="prefetch" href="/assets/js/50.dcffa6b0.js"><link rel="prefetch" href="/assets/js/51.d1b4b080.js"><link rel="prefetch" href="/assets/js/52.b632913d.js"><link rel="prefetch" href="/assets/js/53.dcdbb5d0.js"><link rel="prefetch" href="/assets/js/54.c262f60d.js"><link rel="prefetch" href="/assets/js/55.7088ff48.js"><link rel="prefetch" href="/assets/js/56.22888248.js"><link rel="prefetch" href="/assets/js/57.d75cb523.js"><link rel="prefetch" href="/assets/js/58.5a9870cf.js"><link rel="prefetch" href="/assets/js/59.4b699fa1.js"><link rel="prefetch" href="/assets/js/6.22f00265.js"><link rel="prefetch" href="/assets/js/60.93809700.js"><link rel="prefetch" href="/assets/js/61.40294602.js"><link rel="prefetch" href="/assets/js/62.f967a4b9.js"><link rel="prefetch" href="/assets/js/63.5d35a84d.js"><link rel="prefetch" href="/assets/js/64.ff44d7b3.js"><link rel="prefetch" href="/assets/js/65.61e17f8b.js"><link rel="prefetch" href="/assets/js/7.06dbb2c8.js"><link rel="prefetch" href="/assets/js/8.50cbac4d.js"><link rel="prefetch" href="/assets/js/9.fde02ba2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9825735b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">无来</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/1.基础知识/" class="sidebar-heading clickable open"><span>基础知识</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/1.基础知识/BFC.html" class="sidebar-link">BFC</a></li><li><a href="/1.基础知识/css 加载会阻塞浏览器的执行吗.html" class="sidebar-link">css 加载会阻塞浏览器的执行吗</a></li><li><a href="/1.基础知识/src、href 以及 link 和@import 的区别.html" class="sidebar-link">src、href 以及 link 和@import 的区别</a></li><li><a href="/1.基础知识/tcp、udp的区别以及七层模型.html" class="sidebar-link">tcp、udp的区别以及七层模型</a></li><li><a href="/1.基础知识/v8如何执行一段代码.html" class="sidebar-link">v8如何执行一段代码</a></li><li><a href="/1.基础知识/vue 和 react 的区别.html" class="sidebar-link">vue 和 react 的区别</a></li><li><a href="/1.基础知识/前端路由详解与实现.html" class="active sidebar-link">前端路由详解与实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/1.基础知识/前端路由详解与实现.html#为什么需要前端路由" class="sidebar-link">为什么需要前端路由?</a></li><li class="sidebar-sub-header"><a href="/1.基础知识/前端路由详解与实现.html#前端路由的实现方式" class="sidebar-link">前端路由的实现方式</a></li></ul></li><li><a href="/1.基础知识/性能指标.html" class="sidebar-link">性能指标</a></li><li><a href="/1.基础知识/浏览器输入url后发生了什么.html" class="sidebar-link">浏览器输入url后发生了什么</a></li><li><a href="/1.基础知识/理解 node 中的几个路径.html" class="sidebar-link">理解 node 中的几个路径</a></li><li><a href="/1.基础知识/线程、进程以及浏览器主要进程理解.html" class="sidebar-link">线程、进程以及浏览器主要进程理解</a></li><li><a href="/1.基础知识/记录一次SameSite的问题.html" class="sidebar-link">记录一次SameSite的问题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/10.webpack/" class="sidebar-heading clickable"><span>webpack</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/10.webpack/webpack 模块化源码分析.html" class="sidebar-link">webpack 模块化源码分析</a></li><li><a href="/10.webpack/打包情况视图.html" class="sidebar-link">打包情况视图</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/2.js深入浅出/" class="sidebar-heading clickable"><span>js深入浅出</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/2.js深入浅出/es6-let和const.html" class="sidebar-link">es6-let和const</a></li><li><a href="/2.js深入浅出/es6-箭头函数.html" class="sidebar-link">es6-箭头函数</a></li><li><a href="/2.js深入浅出/js-new的原理.html" class="sidebar-link">js-new的原理</a></li><li><a href="/2.js深入浅出/js-原型.html" class="sidebar-link">js-原型</a></li><li><a href="/2.js深入浅出/map,setMap以及set,wekSet的区别.html" class="sidebar-link">map,setMap以及set,wekSet的区别</a></li><li><a href="/2.js深入浅出/null 和 undefined 的区别.html" class="sidebar-link">null 和 undefined 的区别</a></li><li><a href="/2.js深入浅出/sort 的内部实现.html" class="sidebar-link">sort 的内部实现</a></li><li><a href="/2.js深入浅出/函数执行过程.html" class="sidebar-link">函数执行过程</a></li><li><a href="/2.js深入浅出/判断类型.html" class="sidebar-link">判断类型</a></li><li><a href="/2.js深入浅出/数组的冷知识.html" class="sidebar-link">数组的冷知识</a></li><li><a href="/2.js深入浅出/模块化及区别.html" class="sidebar-link">模块化及区别</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/3.手写系列/" class="sidebar-heading clickable"><span>手写系列</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/3.手写系列/实现一个 Vuex 核心功能.html" class="sidebar-link">实现一个 Vuex 核心功能</a></li><li><a href="/3.手写系列/实现一个 tcp 以及 http 服务.html" class="sidebar-link">实现一个 tcp 以及 http 服务</a></li><li><a href="/3.手写系列/实现一个千分位分隔符.html" class="sidebar-link">实现一个千分位分隔符</a></li><li><a href="/3.手写系列/手写call,bind,apply.html" class="sidebar-link">手写call,bind,apply</a></li><li><a href="/3.手写系列/装饰器.html" class="sidebar-link">装饰器</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/4.vue/" class="sidebar-heading clickable"><span>vue</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/4.vue/使用动态插槽灵活封装 table 组件.html" class="sidebar-link">使用动态插槽灵活封装 table 组件</a></li><li><a href="/4.vue/开发心得-自定义指令的妙用.html" class="sidebar-link">开发心得-自定义指令的妙用</a></li><li><a href="/4.vue/详解 computed 的实现原理.html" class="sidebar-link">详解 computed 的实现原理</a></li><li><a href="/4.vue/详解 watch 的实现原理.html" class="sidebar-link">详解 watch 的实现原理</a></li><li><a href="/4.vue/详解响应式原理.html" class="sidebar-link">详解响应式原理</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/5.react/" class="sidebar-heading clickable"><span>react</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/5.react/umi中 react嵌套路由父给子路由传参.html" class="sidebar-link">umi中 react嵌套路由父给子路由传参</a></li><li><a href="/5.react/使用context.html" class="sidebar-link">使用context</a></li><li><a href="/5.react/解决react路由参数报错.html" class="sidebar-link">解决react路由参数报错</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/6.代码片段/" class="sidebar-heading clickable"><span>代码片段</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/6.代码片段/mac 文件损坏无法打开问题.html" class="sidebar-link">mac 文件损坏无法打开问题</a></li><li><a href="/6.代码片段/npm, yarn 配置淘宝源.html" class="sidebar-link">npm, yarn 配置淘宝源</a></li><li><a href="/6.代码片段/vue-高阶组件.html" class="sidebar-link">vue-高阶组件</a></li><li><a href="/6.代码片段/下载图片或文件.html" class="sidebar-link">下载图片或文件</a></li><li><a href="/6.代码片段/使用 background 画虚线.html" class="sidebar-link">使用 background 画虚线</a></li><li><a href="/6.代码片段/使用 require.context 自动注册全局组件.html" class="sidebar-link">context 自动注册全局组件</a></li><li><a href="/6.代码片段/元素垂直拖动.html" class="sidebar-link">元素垂直拖动</a></li><li><a href="/6.代码片段/在HTML中根据当前环境插入不同 js 文件.html" class="sidebar-link">在HTML中根据当前环境插入不同 js 文件</a></li><li><a href="/6.代码片段/自定义 ElementUi-tooltip 的悬浮位置.html" class="sidebar-link">自定义 ElementUi-tooltip 的悬浮位置</a></li><li><a href="/6.代码片段/记录一次代码提交前的拦截操作.html" class="sidebar-link">记录一次代码提交前的拦截操作</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/7.奇奇怪怪的知识点/" class="sidebar-heading clickable"><span>奇奇怪怪的知识点</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/7.奇奇怪怪的知识点/一个会卡死的正则.html" class="sidebar-link">一个会卡死的正则</a></li><li><a href="/7.奇奇怪怪的知识点/为什么数组中不能展开一个对象.html" class="sidebar-link">为什么数组中不能展开一个对象</a></li><li><a href="/7.奇奇怪怪的知识点/为什么要使用 require 引入动态图片.html" class="sidebar-link">为什么要使用 require 引入动态图片</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/8.docker/" class="sidebar-heading clickable"><span>docker</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/8.docker/docker+jenkins自动化部署.html" class="sidebar-link">docker+jenkins自动化部署</a></li><li><a href="/8.docker/记录一次docker的学习.html" class="sidebar-link">记录一次docker的学习</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/9.nginx/" class="sidebar-heading clickable"><span>nginx</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/9.nginx/nginx 添加环境变量.html" class="sidebar-link">nginx 添加环境变量</a></li><li><a href="/9.nginx/记录一次nginx反向代理跨域的学习.html" class="sidebar-link">记录一次nginx反向代理跨域的学习</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/算法/" class="sidebar-heading clickable"><span>算法</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/算法/子集,全排列.html" class="sidebar-link">子集,全排列</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>程序开发中的路由分为后端路由和前端路由。</p> <p>前端路由就是把不同路由对应不同的内容或页面的任务交给前端来做。路由描述的是 URL 与 UI 之间的映射关系，这种映射是单向的，即 URL 变化引起 UI 更新（无需刷新页面）。</p> <p>后端路由通过用户请求的URL分发到具体的处理程序，浏览器每次跳转到不同的 URL 都会重新访问服务器。服务器收到请求后，将数据和模板组合，返回HTML页面，或者直接返回HTML模板，由前端JavaScript程序再去请求数据，使用前端模板和数据进行组合生成最终的HTML页面。</p> <h2 id="为什么需要前端路由"><a href="#为什么需要前端路由" class="header-anchor">#</a> 为什么需要前端路由?</h2> <p>由于单页面应用 SPA(Single Page Application)的流行, 前端路由已经成为了各大厂框架的标配 。那么 SPA 和前端路由有什么关系呢?</p> <p>单页面应用: 只有一张Web页面的应用，单页面跳转仅刷新局部资源 ，公共资源(js、css等)仅需加载一次。页面只会加载一次，页面内容的更换通过 js 感知页面 url 的变化动态的去更新。这个时候路由是放在前端来做。</p> <p>由于 SPA 中用户的交互是通过 JS 改变 HTML 内容来实现的，页面本身的 url 并没有变化，这导致了两个问题：</p> <ol><li>SPA 无法记住用户的操作记录，无论是刷新、前进还是后退，都无法展示用户真实的期望内容。</li> <li>SPA 中虽然由于业务的不同会有多种页面展示形式，但只有一个 url，对 SEO 不友好，不方便搜索引擎进行收录。</li></ol> <p>前端路由就是为了解决上述问题而出现的。</p> <h2 id="前端路由的实现方式"><a href="#前端路由的实现方式" class="header-anchor">#</a> 前端路由的实现方式</h2> <p>简单的说，就是在保证只有一个 HTML 页面，且与用户交互时不刷新和跳转页面的同时，为 SPA 中的每个视图展示形式匹配一个特殊的 url。在刷新、前进、后退和SEO时均通过这个特殊的 url 来实现。</p> <p>为实现这一目标，我们需要做到以下二点：</p> <ol><li>改变 url 且不让浏览器像服务器发送请求</li> <li>可以监听到 url 的变化</li></ol> <p>览器自身的特性: hash 模式和 history 模式实现了上面的目标。</p> <h3 id="hash-模式"><a href="#hash-模式" class="header-anchor">#</a> hash 模式</h3> <p>这里的 hash 就是指 url 后的 # 号以及后面的字符。比如说 &quot;<a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.baidu.com%2F%23hashhash" target="_blank" rel="noopener noreferrer">www.baidu.com/#hashhash<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>&quot; ，其中 &quot;#hashhash&quot; 就是我们期望的 hash 值。</p> <p>由于 hash 值的变化不会导致浏览器像服务器发送请求，而且 hash 的改变会触发 <strong>hashchange</strong> 事件，浏览器的前进后退也能对其进行控制，所以在 H5 的 history 模式出现之前，基本都是使用 hash 模式来实现前端路由。</p> <p>实现代码:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">HashRouter</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">routerList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>routerList <span class="token operator">=</span> routerList
    <span class="token keyword">this</span><span class="token punctuation">.</span>routerCallbacks <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 获取 hash 路由地址</span>
  <span class="token keyword">static</span> <span class="token function">getHashUrl</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> regResult <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(?&lt;=.*#\/).*$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> regResult <span class="token operator">?</span> regResult<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token string">''</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 初始化方法: 注册路由以及监听 hashchange 方法</span>
  <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'hashchange'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onHashChange</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// hashchange 时出发该方法</span>
  <span class="token function">onHashChange</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> newURL <span class="token punctuation">}</span> <span class="token operator">=</span> event
    <span class="token keyword">const</span> path <span class="token operator">=</span> HashRouter<span class="token punctuation">.</span><span class="token function">getHashUrl</span><span class="token punctuation">(</span>newURL<span class="token punctuation">)</span>
    path <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeRouter</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 注册路由, 第一个路由默认作为首页</span>
  <span class="token function">registerRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>routerList<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> router <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>routerList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>routerCallbacks<span class="token punctuation">[</span>router<span class="token punctuation">.</span>path<span class="token punctuation">]</span> <span class="token operator">=</span> router<span class="token punctuation">.</span>path
    <span class="token punctuation">}</span>

    <span class="token comment">// 第一个路由默认作为首页</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>routerCallbacks<span class="token punctuation">[</span><span class="token string">'/'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>routerCallbacks<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>routerList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>path<span class="token punctuation">]</span>

  <span class="token punctuation">}</span>

  <span class="token comment">// 当路由切换的时候会执行该方法</span>
  <span class="token function">changeRouter</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> app <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#app&quot;</span><span class="token punctuation">)</span>

    <span class="token comment">// 如果已经注册, 则插入注册路由名字</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>routerCallbacks<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      app<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>routerCallbacks<span class="token punctuation">[</span>path<span class="token punctuation">]</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 如果没有注册, 则显示找不到路由</span>
    app<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">找不到路由</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>

  <span class="token punctuation">}</span>

  <span class="token comment">// 加载路由</span>
  <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> path <span class="token operator">=</span> HashRouter<span class="token punctuation">.</span><span class="token function">getHashUrl</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeRouter</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'page1'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'page1'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'page2'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'page2'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'page3'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'page3'</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token keyword">const</span> hashRouter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashRouter</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span>

hashRouter<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br></div></div><h3 id="history-模式"><a href="#history-模式" class="header-anchor">#</a> history 模式</h3> <p>在 HTML5 之前，浏览器就已经有了 history 对象。但只能用于多页面的跳转</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>history<span class="token punctuation">.</span><span class="token function">go</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// 后退一页</span>
history<span class="token punctuation">.</span><span class="token function">go</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 前进两页</span>
history<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 前进一页</span>
history<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 后退一页</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>在 HTML5 的规范中，history 新增了以下几个 API：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// 添加新的状态到历史状态栈</span>
history<span class="token punctuation">.</span><span class="token function">replaceState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 用新的状态代替当前状态</span>
history<span class="token punctuation">.</span>state                <span class="token comment">// 返回当前状态对象</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>来自 MDN 的解释:</p> <blockquote><p>HTML5引入了 history.pushState() 和 history.replaceState() 方法，它们分别可以添加和修改历史记录条目。这些方法通常与window.onpopstate 配合使用。</p></blockquote> <p>history.pushState() 和 history.replaceState() 均接收三个参数（state, title, url）</p> <ol><li>state：合法的 Javascript 对象，可以用在 popstate 事件中</li> <li>title：现在大多浏览器忽略这个参数，可以直接用 null 代替</li> <li>url：任意有效的 URL，用于更新浏览器的地址栏</li></ol> <p>由于 history.pushState() 和 history.replaceState() 可以改变 url 同时，不会刷新页面，所以在 HTML5 中的 histroy 具备了实现前端路由的能力。</p> <p>对于单页应用的 history 模式而言，url 的改变只能由下面四种方式引起：</p> <ol><li>点击浏览器的前进或后退按钮</li> <li>点击 a 标签</li> <li>在 JS 代码中触发 history.pushState 函数</li> <li>在 JS 代码中触发 history.replaceState 函数</li></ol> <p>具体实现如下:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">HistoryRouter</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">routerList</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>routerList <span class="token operator">=</span> routerList
    <span class="token keyword">this</span><span class="token punctuation">.</span>routerCallback <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//  base 路径</span>
  <span class="token keyword">static</span> <span class="token constant">BASE_URL</span> <span class="token operator">=</span> <span class="token string">'/test.html/'</span>

  <span class="token keyword">static</span> <span class="token function">getCurPath</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> HistoryRouter<span class="token punctuation">.</span><span class="token constant">BASE_URL</span> <span class="token operator">+</span> url<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token operator">?.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'popstate'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeRouter</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>state<span class="token punctuation">.</span>path<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">proxyHref</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 注册路由</span>
  <span class="token function">registerRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> router <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>routerList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>routerCallback<span class="token punctuation">[</span>HistoryRouter<span class="token punctuation">.</span><span class="token function">getCurPath</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> router<span class="token punctuation">.</span>name
    <span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>routerCallback<span class="token punctuation">[</span><span class="token string">'/'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>routerList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name
  <span class="token punctuation">}</span>

  <span class="token comment">// 更换页面内容</span>
  <span class="token function">changeRouter</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">!</span>path <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">'/'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> app <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>routerCallback<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      app<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>routerCallback<span class="token punctuation">[</span>path<span class="token punctuation">]</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    app<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">找不到路由</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 在路由栈中新增一条记录</span>
  <span class="token function">push</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> path <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeRouter</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 替换当前记录</span>
  <span class="token function">replace</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    history<span class="token punctuation">.</span><span class="token function">replaceState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> path <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeRouter</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 劫持 a 标签的跳转 替换为 push 方法</span>
  <span class="token function">proxyHref</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> dom <span class="token operator">=</span> e<span class="token punctuation">.</span>target
      <span class="token keyword">if</span> <span class="token punctuation">(</span>dom<span class="token punctuation">.</span>tagName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> path <span class="token operator">=</span> HistoryRouter<span class="token punctuation">.</span><span class="token function">getCurPath</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>href<span class="token punctuation">)</span>
        e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeRouter</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'page1'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'page1'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'page2'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'page2'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'page3'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'page3'</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>


<span class="token keyword">const</span> route <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HistoryRouter</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span>
route<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/22/2023, 2:56:05 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/1.基础知识/vue 和 react 的区别.html" class="prev">
        vue 和 react 的区别
      </a></span> <span class="next"><a href="/1.基础知识/性能指标.html">
        性能指标
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.24709d44.js" defer></script><script src="/assets/js/2.dc5a3d57.js" defer></script><script src="/assets/js/13.bd5b6688.js" defer></script>
  </body>
</html>
