<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>什么是跨域？ | 无来</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="喵巨人学习笔记，包含前端开发、后端开发、服务器运维等">
    
    <link rel="preload" href="/assets/css/0.styles.03f3f677.css" as="style"><link rel="preload" href="/assets/js/app.9ba6ad9d.js" as="script"><link rel="preload" href="/assets/js/2.dc5a3d57.js" as="script"><link rel="preload" href="/assets/js/14.6191993c.js" as="script"><link rel="prefetch" href="/assets/js/10.dfb86eed.js"><link rel="prefetch" href="/assets/js/11.e0dc0288.js"><link rel="prefetch" href="/assets/js/12.6694002d.js"><link rel="prefetch" href="/assets/js/13.bc139a8b.js"><link rel="prefetch" href="/assets/js/3.e1ea490f.js"><link rel="prefetch" href="/assets/js/4.810a9dda.js"><link rel="prefetch" href="/assets/js/5.0559d5c3.js"><link rel="prefetch" href="/assets/js/6.22f00265.js"><link rel="prefetch" href="/assets/js/7.2c4bf3fe.js"><link rel="prefetch" href="/assets/js/8.86337e4e.js"><link rel="prefetch" href="/assets/js/9.fb06a92c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.03f3f677.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">无来</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/docker/" class="sidebar-heading clickable open"><span>docker</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/docker/docker+jenkins自动化部署.html" class="sidebar-link">docker+jenkins自动化部署</a></li><li><a href="/docker/记录一次docker的学习.html" class="sidebar-link">记录一次docker的学习</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/webpack/" class="sidebar-heading clickable"><span>webpack</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/webpack/记录一次代码提交前的拦截操作.html" class="sidebar-link">记录一次代码提交前的拦截操作</a></li></ul></section></li><li><a href="/记录一次SameSite的问题.html" class="sidebar-link">记录一次SameSite的问题</a></li><li><a href="/记录一次nginx反向代理跨域的学习.html" class="active sidebar-link">记录一次nginx反向代理跨域的学习</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/记录一次nginx反向代理跨域的学习.html#示例" class="sidebar-link">示例</a></li><li class="sidebar-sub-header"><a href="/记录一次nginx反向代理跨域的学习.html#如何解决" class="sidebar-link">如何解决</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="什么是跨域"><a href="#什么是跨域" class="header-anchor">#</a> 什么是跨域？</h1> <p>跨域是因为浏览器的同源策略导致的。</p> <blockquote><p>同源策略是一个重要的安全策略，它用于限制一个 origin 的文档或者它加载的脚本如何能与另一个源的资源进行交互。它能帮助阻隔恶意文档，减少可能被攻击的媒介。 -MDN</p></blockquote> <p><code>注意：跨域问题只会在浏览器端产生。</code></p> <p>何为同源策略呢：简单来说就是协议，域名，端口都一致才会被认定为同源。</p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7bfedd53898f473db3c00ac3d7340aec~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p> <h2 id="示例"><a href="#示例" class="header-anchor">#</a> 示例</h2> <p>本地启动一个后台服务并编写一个简单接口，端口为 3009</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa-router&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> cors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa2-cors&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/cors&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 ctx<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span>
 ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&quot;hello cors&quot;</span>
 <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// app.use(cors())</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3009</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>前端页面请求该接口，由于同源策略会造成跨域。
<img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cdee4e24954c494fa81aec18294f41f4~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p> <h2 id="如何解决"><a href="#如何解决" class="header-anchor">#</a> 如何解决</h2> <p>下面说说项目中用过的方式</p> <h3 id="_1-cors"><a href="#_1-cors" class="header-anchor">#</a> 1. cors</h3> <blockquote><p>CORS （Cross-Origin Resource Sharing，跨域资源共享）是一个系统，它由一系列传输的 HTTP 头组成，这些 HTTP 头决定浏览器是否阻止前端 JavaScript 代码获取跨域请求的响应。</p></blockquote> <blockquote><p>同源安全策略 默认阻止“跨域”获取资源。但是 CORS 给了 web 服务器这样的权限，即服务器可以选择，允许跨域请求访问到它们的资源。</p></blockquote> <p>具体来说就是设置一些 aca 响应头，通过这些参数制定浏览器与服务器之间进行交流的规则。</p> <blockquote><p>Access-Control-Allow-Origin：该字段是必须的。它的值要么是请求时 Origin 字段的值，要么是一个*，表示接受任意域名的请求。<br>
Access-Control-Allow-Credentials：该字段可选。它的值是一个布尔值，表示是否允许发送 Cookie。<br>
Access-Control-Expose-Headers：该字段可选。指定想拿到的字段。</p></blockquote> <p>当前后端项目直接使用 koa-cors 中间件。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> cors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa2-cors&quot;</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>控制台可以查看如下信息，成功获取接口信息。
<img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0106d40ba8824e048d8535cc097c5d16~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p> <h3 id="_2-webpack-配置-proxy"><a href="#_2-webpack-配置-proxy" class="header-anchor">#</a> 2. webpack 配置 proxy</h3> <p>大多数本地项目会才用该方式来处理开发阶段产生的跨域问题</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code> proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
     '/api/'<span class="token operator">:</span> <span class="token punctuation">{</span>
        target<span class="token operator">:</span> 'https<span class="token operator">:</span><span class="token comment">//www.test.com', // 需要代理的域名</span>
        changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 如果接口跨域，需要进行这个参数配置为true</span>
        pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span>
            '^/api'<span class="token operator">:</span> ''<span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_3-nginx-反向代理"><a href="#_3-nginx-反向代理" class="header-anchor">#</a> 3. nginx 反向代理</h3> <p>利用 nginx 服务将请求转发到相同域名下从而解决跨域问题<br>
nginx 配置：</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code>// 在location添加一项配置
<span class="token directive"><span class="token keyword">location</span> /nginx/</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">proxy_pass</span>  http://127.0.0.1:3009/</span><span class="token punctuation">;</span>  <span class="token comment"># 代理的域名</span>
        <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>项目中使用<code>/nginx/</code>来代理 <code>http://127.0.0.1:3009/</code>, 我这里 nginx 监听的是 8080 端口，因此请求为</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:8080/nginx/cors'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在这里发现了一个问题，此时控制台查看当前请求处于跨域状态</p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e84566a934684814a8410e769b79c564~tplv-k3u1fbpfcp-watermark.image" alt="image.png">
发现是因为当前接口并没有设置跨域请求头，因此需要在 nginx 配置中设置为允许跨域</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /nginx/</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">proxy_pass</span>  http://127.0.0.1:3009/</span><span class="token punctuation">;</span>  <span class="token comment"># 代理的域名</span>
            <span class="token directive"><span class="token keyword">add_header</span> Access-Control-Allow-Origin *</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>重启 nginx 服务可成功获取接口信息</p> <p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/85a04e81c13b4136a77793986ec44055~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/记录一次SameSite的问题.html" class="prev">
        记录一次SameSite的问题
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9ba6ad9d.js" defer></script><script src="/assets/js/2.dc5a3d57.js" defer></script><script src="/assets/js/14.6191993c.js" defer></script>
  </body>
</html>
